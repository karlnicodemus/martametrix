<!DOCTYPE html>
<html lang="en">
<head>
  <title>Marta Metrics</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <link href="header.css" rel="stylesheet">
  <link href="main.css" rel="stylesheet">
  <link rel="stylesheet" href="scripts/leaflet/leaflet.css" />
  <script src="scripts/leaflet/leaflet.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />
   <script src="d3.min.js"></script>
    <script src='features.json'></script>
  <script src='paths.json'></script>
<script src='chartsScript.js'></script>
  <script src="nav.js"></script>

</head>
<body>
<div class="container">
	<!-- Header -->
	<div class="row">
  		<div class="col-xs-10 col-sm-9">
  			<h1 class="large"><b>ATLANTA</b>GEORGIA </h1>
  		</div>
  		<div class="col-xs-2 col-sm-3 col-logo">
  			<img src="./files/logo.png" class="img-responsive logo"/><img src="./files/logo2.png" class="img-responsive logo2"/>
  		</div>
	</div>
	<!--Content-->
	<div class="row">
		<div id="map" class="col-lg-6 col-md-9 col-xs-10 col-main1">
				<!--<div id="map"> </div>-->
				<script type="text/javascript">
                    
                    
                    
					L.mapbox.accessToken = 'pk.eyJ1Ijoic3RhY2VidWciLCJhIjoiY2lndHRmZWQyMDhzdHYxa28yeDk0b2kydCJ9.66UKWBa3jEwcoJ4BAEUuVQ';
					var southWest = L.latLng(33.583602, -84.504154),
    					northEast = L.latLng(33.959462, -84.198486),
    					bounds = L.latLngBounds(southWest, northEast);
					var map = L.mapbox.map('map', 'mapbox.streets',{maxBounds:bounds, maxZoom:13, minZoom:11}).setView([33.748465061732354, -84.39079284667969],11)
					var tileLayer = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
   						attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    					id: 'stacebug.cigttfd6e08yjueko0jdf33ix', 
    					accessToken: 'pk.eyJ1Ijoic3RhY2VidWciLCJhIjoiY2lndHRmZWQyMDhzdHYxa28yeDk0b2kydCJ9.66UKWBa3jEwcoJ4BAEUuVQ'
					}).addTo(map);
                    
                    
                    
					var myLayer = L.mapbox.featureLayer(paths).addTo(map);
		
					var iconLayer = L.mapbox.featureLayer().addTo(map);
					iconLayer.on('layeradd', function(e) {
						var icons = e.layer;
						var feature = icons.feature;
						icons.setIcon(L.icon(feature.properties.icon));
					})

					iconLayer.setGeoJSON(data);

//Below is trying  to change the text on click
                    
                
					iconLayer.on('click', function(e) {
                        
                        

                        $('#transportationClass').empty();
                        $('#transportationClass').append('<b class="data-content"> <p style="height:20px">TRANSPORTATION</p></b>');

                        
                        var dataset = [];
						clickedName = e.layer.feature.properties["MARTA STOP"];
						clickedPoverty = e.layer.feature.properties["%BELOWPOVERTY"];
						changeText();
                        var values = [e.layer.feature.properties["MARTA STOP"], 
                                 e.layer.feature.properties["DRIVE ALONE"],                                                                                            e.layer.feature.properties["CARPOOL"],     
                                 e.layer.feature.properties["BUS"],  
                                 e.layer.feature.properties["MARTA"], 
                                 e.layer.feature.properties["BIKE"], 
                                 e.layer.feature.properties["WALK"]];
                                //console.log(values);
                                arr = values.slice();
                                //console.log(arr);
                        
                        
                                var result = {
                                    name: values[0],
                                    driveAlone: parseFloat(values[1]),
                                    carpool: parseFloat(values[2]),
                                    bus: parseFloat(values[3]),
                                    marta: parseFloat(values[4]),
                                    bike: parseFloat(values[5]),
                                    walk: parseFloat(values[6])
                                };
                        
                                console.log(result);
                        
                                var DRIVEALONE = {
                                    text: "Drive Alone",
                                    data: result.driveAlone
                                    }
                                    var CARPOOL = {
                                    text: "Carpool",
                                    data: result.carpool
                                    }
                                    var BUS = {
                                    text: "Bus",
                                    data: result.bus
                                    }
                                    var MARTA = {
                                    text: "Marta",
                                    data: result.marta
                                    }
                                    var BIKE = {
                                    text: "Bike",
                                    data: result.bike
                                    }
                                    var WALK = {
                                    text: "Walk",
                                    data: result.walk
                                    }
    
                                dataset.push(DRIVEALONE, CARPOOL, BUS, MARTA, BIKE, WALK);
                                
                                console.log(dataset);
                        
                                 var margin = {top: 50, right: 50, left: 50, bottom:50};

        var width = 500 - margin.right - margin.left,
            height = 300 - margin.top - margin.bottom;


        var xScale = d3.scale.linear()
            .domain([0, d3.max(dataset)])
            .range([0, width]);

        var yScale = d3.scale.ordinal()
            .domain(d3.range(0, dataset.length))
            .rangeBands([0, height], .1);
    
        var chartContainer = d3.select("#transportationClass")
            .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom);
            //.style('background', '#4FFFFF');
        
        var chart = chartContainer.selectAll('rect')
            .data(dataset)
            .enter().append('rect')
            .attr('fill', '#CC0000')
            .attr('x', margin.left + 55)
            .attr('y', function(d,i) {
                return yScale(i) + margin.top;
            })
            .attr('width', function(d) {
                console.log( xScale());
                console.log("Before this is read", d.data);
                return d.data * 5;
            })
            .attr('height', yScale.rangeBand());

        //Text inclusions

          chartContainer.selectAll('text')
            .data(dataset)
            .enter()
            .append('text')
            .text(function(d) {
                return d.text;
            })
            .attr("x", function(d, i) {
            return margin.left - 50;
           })
           .attr("y", function(d, i) {
                return yScale(i) + margin.top + 20;
            });
        chartContainer.selectAll('text')
            .data(dataset)
            .enter()
            .append('text')
            .text(function(d) {
                return d.text;
            })
            .attr("x", 50)
            .attr("y", 50)
                        
                                
                        
                        
                                
					   });
                    //console.log(arr);
					function changeText() {
						document.getElementById("text1").innerHTML = clickedName;
						document.getElementById("text2").innerHTML = clickedName;
						document.getElementById("poverty").innerHTML = clickedPoverty + "%";
					}
                    
                        
                    
//Break
					</script> 
				
		</div>
		<a href="javascript:void(0);" onclick="toggle_visibility('data');" style="text-decoration:none;">
			<div id="data" class="col-lg-6 col-md-3 col-xs-2 col-main2">
				<div class="col-type col-data" style="display:block;">
					<div class="data-hidden">
						<h1 class="data-header-hidden"><b><div id = "text1">Midtown</div></b></h1>
					</div>
					<div class="data-complete">
						<h1 class="data-header"><b><div id = "text2">Midtown</div></b></h1>
						<div id = "transportationClass" style="height: 350px">
							<b class="data-content">
								<p style="height:20px">TRANSPORTATION</p>
							</b>
							<!-- Put transportation data here -->
						</div>
						<div class = "crimeClass" style="height: 300px">
							<b class="data-content">
								<p style="height:20px">CRIME</p>
							</b>
							<!-- Put crime data here -->
						</div>
						<div class = "povertyClass" style="height: 100px">
							<b class="data-content">
								<p style="height:20px">POVERTY</p>
							</b>
							<h1 class="data-header" style="padding-top:20px;">
								<b><div id = "poverty" style="color: #DD0000; float:left;">8.9%</div></b>
								<p style="float:right; font-size:24px; color:#000000; padding-top: 6px; padding-left:15px;">OF POPULATION LIVES BELOW</br>THE POVERTY LEVEL ($23,283)</p>
							</h1>							
						</div>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>
</body>
</html>
